# AI工具调用优化改进方向

## 📋 问题描述

在对话历史功能测试中发现，当用户询问具体项目详情时，AI模型存在工具调用时机判断不准确的问题：

### 具体表现
- 用户询问"Ideas Collection项目详情"时，AI前两轮基于对话历史回答，未调用工具获取最新数据
- 第三轮用户明确提到"候选人个人项目"后，AI才调用 `get_personal_projects` 工具
- 导致用户需要多轮对话才能获得满意的详细回答

## 🔍 根因分析

### 1. 上下文依赖问题
- AI过度依赖对话历史中的信息
- 没有意识到需要调用工具获取更详细的结构化数据
- 认为已有信息"足够"回答用户问题

### 2. 提示词理解偏差
- 对"详细介绍"、"能说一下"等请求的工具调用判断不够敏感
- 缺乏"当用户询问具体项目时必须调用工具"的强制逻辑
- 工具调用策略过于保守

### 3. 模型行为局限性
- 不同模型的工具调用策略存在差异
- LLM在工具调用时机判断上的固有局限性

## 🎯 改进方向

### 1. 增强系统提示词 (高优先级)
```
当用户询问以下内容时，必须调用相应工具获取最新数据：
- 具体项目详情 → 必须调用 get_personal_projects 或 get_work_projects
- 技能详情 → 必须调用 get_skills
- 工作经历详情 → 必须调用 get_work_experience
- 教育背景详情 → 必须调用 get_education_background

即使对话历史中有相关信息，也要调用工具确保信息的完整性和准确性。
```

### 2. 优化工具描述 (中优先级)
- 在工具描述中明确说明何时应该调用该工具
- 增加触发关键词提示
- 强调工具调用的必要性场景

### 3. 实现工具调用强制逻辑 (中优先级)
- 考虑在特定关键词触发时强制调用工具
- 实现"用户询问具体项目 → 自动调用工具"的逻辑
- 减少对模型判断的依赖

### 4. 模型选择优化 (低优先级)
- 测试不同模型的工具调用表现
- 评估 OpenAI vs 千问 在工具调用策略上的差异
- 选择工具调用更积极的模型

### 5. 用户体验优化 (低优先级)
- 当AI基于历史信息回答时，主动提示"是否需要获取最新详细信息"
- 提供"获取详细信息"的快捷按钮
- 实现更智能的信息补充机制

## 📊 预期效果

### 短期目标
- 减少用户获取详细信息所需的对话轮数
- 提高首次回答的信息完整性
- 增强用户体验满意度

### 长期目标
- 建立更智能的工具调用策略
- 实现主动信息补充机制
- 提升AI助手的专业性和可靠性

## 🔧 实施计划

### Phase 1: 系统提示词优化 (1-2天)
- 修改 `SYSTEM_PROMPT` 增加强制工具调用规则
- 测试不同提示词策略的效果
- 验证改进效果

### Phase 2: 工具描述优化 (1天)
- 优化所有MCP工具的描述文本
- 增加触发场景说明
- 更新工具调用指导

### Phase 3: 逻辑层面优化 (2-3天)
- 实现关键词触发机制
- 添加工具调用决策日志
- 完善错误处理和降级策略

### Phase 4: 测试和验证 (1-2天)
- 全面测试各种询问场景
- 收集用户反馈
- 性能和准确性评估

## 📝 备注

- 当前代码结构和工具实现本身没有问题
- 主要是AI模型的工具调用策略需要优化
- 建议优先从系统提示词入手，成本最低效果最明显

---

**创建时间**: 2025-05-26  
**优先级**: 中等  
**预估工作量**: 5-8天  
**负责人**: 待定 
# AI候选人BFF功能路线图

## 概述

本文档记录了AI候选人BFF项目的三个核心功能增强计划，包括详细的实现方案和技术架构设计。

## 功能优先级

1. **🔧 细化MCP工具功能** - 优先级：高 (最容易实现，影响最大)
2. **💬 对话历史功能** - 优先级：中 (中等难度，用户体验提升明显)
3. **🎯 临时对话选项功能** - 优先级：低 (最复杂，但最有创新性)

---

## 功能1：细化MCP工具功能

### 当前状态分析
- 现在只有一个 `get_resume_text` 返回完整简历JSON
- 工具粒度太粗，AI需要从大JSON中提取信息
- 存在语义匹配问题（如"教育背景"vs"学历"）

### 实现方案

#### 数据拆分策略
新增以下细化工具：
```javascript
- get_education_background    // 教育背景/学历
- get_work_experience        // 工作经历  
- get_personal_projects      // 个人项目
- get_work_projects         // 工作项目
- get_skills               // 技能特长
- get_other_experience     // 非IT经历/其他经历
- get_basic_info          // 基本信息（姓名、联系方式等）
```

#### 实现层级
1. **配置层**：在 `config/resume-content.js` 中保持原有结构
2. **服务层**：在 `src/services/mcpService.js` 中添加新的方法
3. **工具层**：在 `llmService.js` 中注册新的 DynamicTool
4. **描述优化**：每个工具有清晰的中英文描述，解决语义匹配问题

#### 工具描述示例
```javascript
new DynamicTool({
  name: "mcp__candidate__get_education_background",
  description: "获取候选人的教育背景、学历、教育经历信息 (Get candidate's education background, academic qualifications, educational experience)",
  func: async () => {
    const result = await mcpService.getEducationBackground();
    return JSON.stringify(result);
  },
})
```

#### 预期效果
- AI可以精确调用需要的信息模块
- 减少token消耗，提高响应速度
- 更好的语义匹配，解决中文表达差异问题
- 支持更细粒度的信息查询

---

## 功能2：对话历史功能

### 当前状态分析
- 目前每次对话都是独立的，没有上下文记忆
- LLM服务中每次都创建新的消息数组：`[system, user]`
- 前端也没有历史记录存储

### 实现方案

#### 后端架构设计

**会话管理：**
- 引入 `sessionId` 概念，每个用户会话有唯一ID
- 会话ID生成：使用UUID或时间戳+随机数

**存储方案：**
- **阶段1（简单方案）**：内存存储（Map结构，重启丢失，适合demo）
- **阶段2（持久化方案）**：Redis/SQLite存储

**消息历史结构：**
```javascript
{
  sessionId: "uuid-string",
  messages: [
    {role: "system", content: "系统提示词"},
    {role: "user", content: "用户消息1", timestamp: "2025-01-01T10:00:00Z"},
    {role: "assistant", content: "AI回复1", timestamp: "2025-01-01T10:00:05Z"},
    {role: "user", content: "用户消息2", timestamp: "2025-01-01T10:01:00Z"},
    // ...
  ],
  createdAt: "2025-01-01T10:00:00Z",
  updatedAt: "2025-01-01T10:01:00Z"
}
```

**API设计：**
```javascript
// 新增端点
POST /chat/:sessionId     // 带会话ID的对话
GET /chat/:sessionId      // 获取会话历史
DELETE /chat/:sessionId   // 清空会话历史
POST /chat/new           // 创建新会话
```

#### 前端架构设计

**会话管理：**
- 在 `localStorage` 中存储当前会话ID
- 页面加载时检查是否有现有会话
- 提供"新建对话"和"清空历史"功能

**UI组件：**
- 会话信息显示（会话ID、创建时间）
- 历史消息恢复显示
- 会话操作按钮

#### 实现步骤
1. 后端添加会话管理服务
2. 修改 `/chat` 端点支持会话ID
3. 前端添加会话状态管理
4. 测试上下文对话效果

---

## 功能3：临时对话选项功能

### 当前状态分析
- 目前是纯文本输入，用户需要自己想问题
- 没有引导性的交互
- 缺乏智能化的对话引导

### 实现方案

#### 后端生成逻辑

**建议问题生成：**
```javascript
// 在AI回复后，额外调用一次LLM生成建议问题
const suggestedQuestions = await generateSuggestedQuestions(
  conversationContext, 
  lastAIResponse,
  candidateInfo
);
```

**生成策略：**
- **上下文相关**：基于当前对话内容生成相关问题
- **信息补充**：如果谈到项目，建议问技术栈；如果谈到经历，建议问具体职责
- **深度挖掘**：从浅层信息引导到深层信息
- **多样性保证**：避免重复性问题

**Prompt设计：**
```javascript
const SUGGESTION_PROMPT = `
基于以下对话上下文和AI回复，生成2-3个相关的后续问题建议：

对话上下文：${conversationContext}
AI回复：${lastAIResponse}

要求：
1. 问题要具体且有价值
2. 能够深入了解候选人
3. 避免重复已讨论的内容
4. 问题长度控制在15字以内

返回JSON格式：
{
  "suggestions": [
    "问题1",
    "问题2", 
    "问题3"
  ]
}
`;
```

#### 前端交互设计

**UI组件：**
- 建议问题按钮组（在AI回复下方）
- 按钮样式区别于普通消息
- 点击效果：自动填入输入框或直接发送

**交互逻辑：**
```javascript
// 建议问题点击处理
function handleSuggestionClick(question) {
  // 选项1：填入输入框
  document.getElementById('message-input').value = question;
  
  // 选项2：直接发送
  sendMessage(question);
}
```

#### 示例场景
```
用户："项目经验"
AI："陈嘉旭有丰富的项目经验，包括旅游助手智能体、韩国手机号格式统一等项目..."

建议问题：
[旅游助手的技术架构？] [项目中遇到的挑战？] [技术选型的考虑？]
```

#### 实现步骤
1. 设计建议问题生成的Prompt
2. 后端添加建议生成服务
3. 修改 `/chat` 响应格式包含建议
4. 前端添加建议问题UI组件
5. 测试建议质量和用户体验

---

## 技术架构影响分析

### 数据库需求
- **功能1**：无需额外存储
- **功能2**：需要会话存储（内存→Redis/SQLite）
- **功能3**：无需额外存储

### 性能影响
- **功能1**：减少token消耗，提升性能
- **功能2**：增加存储开销，但提升用户体验
- **功能3**：增加额外LLM调用，需要优化

### 前端复杂度
- **功能1**：无影响
- **功能2**：需要状态管理升级
- **功能3**：需要新增UI组件和交互逻辑

### API变更
- **功能1**：新增MCP工具端点
- **功能2**：修改 `/chat` 端点，新增会话管理端点
- **功能3**：修改 `/chat` 响应格式

---

## 开发计划

### 第一阶段：细化MCP工具功能
- **预估时间**：1-2天
- **主要工作**：
  - 拆分resume数据结构
  - 添加新的MCP工具
  - 更新工具描述
  - 测试语义匹配效果

### 第二阶段：对话历史功能
- **预估时间**：2-3天
- **主要工作**：
  - 实现会话管理服务
  - 修改API端点
  - 前端状态管理
  - 历史对话UI

### 第三阶段：临时对话选项功能
- **预估时间**：3-4天
- **主要工作**：
  - 设计建议生成逻辑
  - 实现建议生成服务
  - 前端建议UI组件
  - 用户体验优化

---

## 成功指标

### 功能1成功指标
- [ ] 支持7个细化工具调用
- [ ] "教育背景"和"学历"都能正确响应
- [ ] 响应时间减少30%以上
- [ ] Token消耗减少20%以上

### 功能2成功指标
- [ ] 支持多轮对话上下文
- [ ] 会话历史正确保存和恢复
- [ ] 页面刷新后对话不丢失
- [ ] 支持清空和新建会话

### 功能3成功指标
- [ ] 每次AI回复生成2-3个相关建议
- [ ] 建议问题相关性>80%
- [ ] 用户点击建议问题比例>30%
- [ ] 对话深度和质量明显提升

---

## 风险评估

### 技术风险
- **LLM调用成本**：功能3会增加API调用次数
- **存储扩展性**：功能2的会话存储需要考虑扩展性
- **响应延迟**：建议生成可能影响响应速度

### 用户体验风险
- **建议质量**：生成的建议问题可能不够准确
- **界面复杂度**：新功能可能让界面变得复杂
- **学习成本**：用户需要适应新的交互方式

### 缓解措施
- 实现建议生成的缓存机制
- 提供建议质量的反馈机制
- 保持界面简洁，渐进式功能展示
- 提供功能使用指南

---

*文档创建时间：2025年1月*
*最后更新时间：2025年1月* 